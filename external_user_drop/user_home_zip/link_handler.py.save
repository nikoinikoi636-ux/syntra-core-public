
#!/usr/bin/env python3
import os, json, time
from datetime import datetime

BIONET = ".bionet"
SIG = os.path.join(BIONET, "signals.jsonl")
MEM = os.path.join(BIONET, "memory_link.json")

def ts():
    return datetime.utcnow().isoformat()+"Z"

def append_mem(event):
    rec = {"ts": ts(), "event": event}
    with open(MEM, "a", encoding="utf-8") as f:
        f.write(json.dumps(rec, ensure_ascii=False) + "\n")

def main():
    pos = 0
    while True:
        if not os.path.isfile(SIG):
            time.sleep(2)
            continue
        with open(SIG, "r", encoding="utf-8") as f:
            f.seek(pos)
            line = f.readline()
            while line:
                pos = f.tell()
                try:
                    ev = json.loads(line)
                except Exception:
                    line = f.readline()
                    continue
                if ev.get("topic") == "sentinel.link":
                    append_mem(ev)
                    print("üîó Link signal captured -> –∑–∞–ø–∏—Å–∞–Ω –≤ memory_link.json")
                line = f.readline()
        time.sleep(2)

if __name__ == "__main__":
    main()
